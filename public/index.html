<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Tunnel Homepage</title>
	</head>

	<body>
		<input type="number" name="port" id="port" placeholder="80" />
		<button id="tunnel-toggle"></button>
		<h2 id="status"></h2>



		<script src="/js/axios.min.js"></script>
		<script src="/js/socket.io.js"></script>




		<script>
			const portInput = document.querySelector("#port"),
				tunnelToggleButton = document.querySelector("#tunnel-toggle"),
				statusText = document.querySelector("#status");

			let isTunneling = false;
			const refreshTunnelStatus = () => {
				if (isTunneling) {
					statusText.innerText = `Tunnel is running at port ${portInput.value}`;
					tunnelToggleButton.innerText = "Stop tunneling";
				}
				else {
					statusText.innerText = "Tunnel is stopped";
					tunnelToggleButton.innerText = "Start tunneling";
				}
			};
			refreshTunnelStatus();

			const toggleTunnel = () => {
				isTunneling = !isTunneling;
				refreshTunnelStatus();
			};

			tunnelToggleButton.onclick = () => {
				if (portInput.value.length < 2)
					statusText.innerText = 'Port length must be at least 2';
				else {
					if (true) {
						toggleTunnel();
					}
				}
			};
		</script>


		<script>
			const socket = io.connect('localhost:5000'); // will be replaced by deployed server

			socket.on('request', (data) => {
				console.log('request', data);

				let reply;
				const url = `http://localhost:${portInput.value}${data.url}`;
				console.log(url);
				axios.get(url).then(res => {
					console.log(res);
					reply = res
					console.log('reply', reply);
					socket.emit('reply', reply.data);
				})
			})
		</script>

	</body>

</html>
